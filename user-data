#cloud-config

# Disable password authentication with the SSH daemon
ssh_pwauth: false

system_info:
  default_user:
    name: iot
    sudo: ALL=(ALL) NOPASSWD:ALL
    home: /home/iot
    shell: /bin/bash
    lock_passwd: True
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAdaHILstx0sODyqPFY2UwL//NEIQ7A1ju3hLmfd2BzC jason@Jasons-MacBook-Pro.local

runcmd:
  - sudo adduser --system ggc_user
  - sudo addgroup --system ggc_group
  - sudo usermod -a -G video ggc_user
  - sudo add-apt-repository -y ppa:deadsnakes/ppa
  - curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
  - wget -O /tmp/aws-iot-greengrass-keyring.deb https://d1onfpft10uf5o.cloudfront.net/greengrass-apt/downloads/aws-iot-greengrass-keyring.deb
  - sudo dpkg -i /tmp/aws-iot-greengrass-keyring.deb
  - echo "deb https://dnw9lb6lzp2d8.cloudfront.net stable main" | sudo tee /etc/apt/sources.list.d/greengrass.list
  - sudo apt update
  - sudo apt install -y aws-iot-greengrass-core python2 python2-dev python3.7 python3.7-dev nodejs openjdk-8-jdk-headless python3-dev python3-pip cmake libssl-dev libffi-dev
  - sudo python3.7 -m pip install --no-cache-dir -U pip
  - sudo python3.8 -m pip install --no-cache-dir -U pip
  - sudo python3.7 -m pip install --no-cache-dir -U scikit-build
  - sudo python3.8 -m pip install --no-cache-dir -U scikit-build
  - sudo python3.7 -m pip install --no-cache-dir opencv-python
  - sudo python3.8 -m pip install --no-cache-dir opencv-python
  - sudo ln -s /usr/bin/node /usr/bin/nodejs
  - sudo ln -s /usr/bin/node /usr/bin/nodejs12.x
  - sudo ln -s /usr/bin/java /usr/bin/java8
  - sudo wget -O /greengrass/certs/root.ca.pem https://www.amazontrust.com/repository/AmazonRootCA1.pem
  - sudo systemctl enable greengrass.service
  - touch /tmp/cloud-init-done
